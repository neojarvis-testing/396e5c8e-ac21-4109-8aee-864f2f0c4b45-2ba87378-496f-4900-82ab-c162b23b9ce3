<app-farmer-navbar></app-farmer-navbar>
<h1>My Requests</h1>

<p *ngIf="requests.length === 0">Oops! No records found</p>

<table class="table table-bordered table-hover mt-3" *ngIf="requests.length > 0">
  <thead class="table-dark">
    <tr>
      <th>Agrochemical Name</th>
      <th>Crop Name</th>
      <th>Quantity</th>
      <th>Status</th>
      <th>Request Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let request of requests">
      <td>{{ request.agroChemicalId?.name }}</td>
      <td>{{ request.cropId?.cropName }}</td>
      <td>{{ request.quantity }}</td>
      <td>{{ request.status }}</td>
      <td>{{ request.requestDate | date:'dd/MM/yyyy' }}</td>
      <td>
        <button class="btn btn-info btn-sm me-2" data-bs-toggle="modal" data-bs-target="#viewRequestModal" (click)="viewRequest(request._id)">
          <i class="bi bi-eye"></i> View
        </button>
        <a class="btn btn-warning btn-sm me-2" [routerLink]="['/farmer/request-form', request._id]">
          <i class="bi bi-pencil"></i> Edit
        </a>
        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal" (click)="confirmDelete(request._id)">
          <i class="bi bi-trash"></i> Delete
        </button>
      </td>
    </tr>
  </tbody>
</table>

<!-- View Request Modal -->
<div class="modal fade" id="viewRequestModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Request Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p><strong>Agrochemical:</strong> {{ selectedRequest?.agroChemicalId?.name }}</p>
        <p><strong>Crop:</strong> {{ selectedRequest?.cropId?.cropName }}</p>
        <p><strong>Quantity:</strong> {{ selectedRequest?.quantity }}</p>
        <p><strong>Status:</strong> {{ selectedRequest?.status }}</p>
        <p><strong>Request Date:</strong> {{ selectedRequest?.requestDate | date:'dd/MM/yyyy' }}</p>
        <p *ngIf="selectedRequest===0">Oops! No records found</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this request?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">No</button>
        <button class="btn btn-danger" (click)="deleteRequest()" data-bs-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>

<!-- Pagination -->
<nav class="mt-3">
  <ul class="pagination justify-content-center">
    <li class="page-item" [class.disabled]="pageNumber === 1">
      <button class="page-link" (click)="changePage(pageNumber - 1)">Previous</button>
    </li>
  
    <li class="page-item" *ngFor="let page of getPages()" [class.active]="pageNumber === page">
      <button class="page-link" (click)="changePage(page)">{{ page }}</button>
    </li>
  
    <li class="page-item" [class.disabled]="pageNumber === totalPages">
      <button class="page-link" (click)="changePage(pageNumber + 1)">Next</button>
    </li>
  </ul>
</nav>